# 黄金波浪理论：文档与代码差异分析

> 基于《黄金波浪理论推理文档》《波浪理论核心算法提炼》最新推理内容，对照 `goldWaveAnalysis.js` 的实现，检查未支持的逻辑。

---

## 一、已支持的功能 ✅

| 功能 | 文档位置 | 代码实现 |
|-----|---------|---------|
| 黄金分割回撤比率 0.236、0.382、0.5、0.618、0.786、0.8 | 文档多处 | `config.js` FIBONACCI_RATIOS |
| 反弹、延伸比率 | 文档多处 | `fibonacci.js` |
| 第三浪延伸目标 1.618、2.618 | 文档 10-速查表 | `wave.js` calculateExtensionLevels |
| 驱动浪规则验证（2浪不破100%、3浪超1浪终点等） | 算法提炼 | `wave.js` validateImpulseRules |
| W-X-Y 联合形识别 | 算法提炼、文档 03 | `wave.js` identifyWXY |
| 参考点位 4540、4600、5100、5150、5450 | 文档 07、10 | `config.js` REFERENCE_POINTS |
| 生命线、第一浪终点等基础状态判断 | 文档 07 | `trend.js` judgeTrend |

---

## 二、未支持或与文档不一致的逻辑 ❌

### 2.1 趋势判断：5 档价格区间未落地

**文档规则**（黄金波浪理论推理文档 04、07）：

| 价格位置 | 趋势状态 | 判断逻辑 |
|---------|---------|---------|
| **> 5100** | 第二浪可能结束 | 突破(v)浪高点，可能进入第三浪 |
| **4850 - 5100** | 调整中 | 在(iv)浪低点和(v)浪高点之间 |
| **4600 - 4850** | 深度调整 | 跌破(iv)浪低点，但未破Y浪低点 |
| **4540 - 4600** | 关键区域 | 接近蓝线0.8位置，需密切关注 |
| **< 4540** | **危险区域** | 跌破蓝线0.8位置，第二浪可能延伸 |

**当前实现**（`src/trend/trend.js`）：

- 4 档逻辑：`wave1End`(≥5600)、`riseVHigh`(≥5218)、`lifeLine`(≥4540)、else
- `riseVHigh` 使用公式 `WAVE_2_LOW + 0.618 * (WAVE_1_END - WAVE_2_LOW)` ≈ **5218**
- 文档的「第二浪可能结束」阈值是 **5100–5150**（(v)浪高点），不是 0.618 反弹位 5218

**差异**：
- 未按 5100、4850、4600、4540 做 5 档细分
- 未使用 `REFERENCE_POINTS.WAVE_2.RISE_V_HIGH: 5150`，而是用 0.618 公式
- 未区分 4850–5100「调整中」与 4600–4850「深度调整」
- 未区分 4540–4600「关键区域」与 4600–4850「深度调整」

---

### 2.2 监测点不完整

**文档监测点**（黄金波浪理论推理文档 07、10）：

- **生命线**：4540 ✓
- **支撑**：4600、4666、4850、4650（(ii)浪低点）
- **压力**：5100–5150、5450

**当前实现**：

- ` REFERENCE_POINTS` 有 4540、4600、5100、5150、5450
- `keyLevels` 由 `analyzeWave2` 动态生成，包含回撤/反弹/延伸位
- **缺少显式**：4666、4850、4650 等文档点名

---

### 2.3 第二浪结构未细化输出

**文档描述**（黄金波浪理论推理文档 03）：
- 第二浪为 W-X-Y 联合形
- 上升 5 浪：(i)-(ii)-(iii)-(iv)-(v)
- 当前橙色路径：(x)-(w)-(y)，处于 (y) 浪下跌

**当前实现**：
- `identifyWXY` 在 `identifyWaves12345AndABC` 内部调用，仅用于 `--wave` 模式
- 主流程 `main()` 使用 `inferWaveStructure` + `analyzeWave2`，未输出 W-X-Y、(i)-(ii)-(iii)-(iv)-(v)、(x)-(w)-(y) 三级结构
- 主流程与 `--wave` 模式两套逻辑未打通

---

### 2.4 技术指标验证缺失

**文档要求**（波浪理论核心算法提炼 06、黄金波浪理论推理文档 08）：
- MACD 金叉/死叉、RSI 与 50 的关系确认趋势
- 成交量（主升浪/反弹浪放量、回调浪缩量）确认

**当前实现**：
- 无 MACD、RSI、成交量计算或验证

---

### 2.5 通用分析模板步骤 6 未实现

**文档模板**（黄金波浪理论推理文档 08）：
- 步骤 1–5：确定浪型 → 找 H、L → 计算关键点位 → 确定监测点 → 趋势判断 ✓
- **步骤 6**：结合 1 小时 K 线形态、成交量、MACD/RSI 进行验证 ❌

---

### 2.6 算法提炼中的 5 浪子浪目标未实现

**文档**（波浪理论核心算法提炼 04）：
- 3 浪目标 = 1 浪 1.618 倍
- 5 浪 1/3/5 子浪目标计算

**当前实现**：
- 有 1.618、2.618 延伸位，但未显式输出 5 浪内部 1/3/5 子浪目标

---

## 三、建议改造项（按优先级）

| 优先级 | 改造项 | 涉及文件 | 说明 |
|-------|--------|---------|------|
| P0 | 趋势判断按 5 档价格区间实现 | `trend.js` | 使用 5100、4850、4600、4540 并引入 `RISE_V_HIGH` |
| P0 | 使用 5100–5150 作为「第二浪可能结束」阈值 | `trend.js` | 用 `REFERENCE_POINTS.WAVE_2.RISE_V_HIGH` 替代 0.618 公式 |
| P1 | 补全监测点 4666、4850、4650 | `wave.js` / `config.js` | 在 `keyLevels` 中显式加入 |
| P2 | 主流程输出 W-X-Y 及 (x)-(w)-(y) 结构 | `goldWaveAnalysis.js` | 或在主流程中复用 `identifyWXY` 结果 |
| P2 | 打通 `--wave` 模式与主流程 | `goldWaveAnalysis.js` | 主流程可复用 `identifyWaves12345AndABC` 与规则验证 |
| P3 | 增加 MACD、RSI、成交量计算与验证 | 新建 `indicators.js` | 可选，用于步骤 6 验证 |
| P3 | 输出 5 浪 1/3/5 子浪目标 | `wave.js` | 按算法提炼公式计算 |

---

## 四、关键代码引用

### 当前趋势判断逻辑（需调整）

```12:79:src/trend/trend.js
function judgeTrend(currentPrice, analysis) {
  // ...
  const status = {
    lifeLine: currentPrice >= monitorPoints.LIFE_LINE,
    wave1End: currentPrice >= monitorPoints.WAVE_1_END,
    wave2Low: currentPrice >= monitorPoints.WAVE_2_LOW,
    riseVHigh: currentPrice >= (monitorPoints.WAVE_2_LOW + (monitorPoints.WAVE_1_END - monitorPoints.WAVE_2_LOW) * 0.618)
  };
  // ...
  if (status.wave1End) {
    trend = '第三浪上涨';
  } else if (status.riseVHigh) {
    trend = '第二浪反弹';
  } else if (status.lifeLine) {
    trend = '第二浪调整';
  } else {
    trend = '第二浪深度调整';
  }
}
```

### 文档期望的 5 档逻辑（建议实现）

```javascript
// 建议：使用 REFERENCE_POINTS 中的实际点位
const riseVHigh = REFERENCE_POINTS.WAVE_2.RISE_V_HIGH; // 5150
const ivLow = 4850;   // (iv)浪低点
const yLow = 4600;    // Y浪低点
const lifeLine = 4540;

if (currentPrice > 5100) trend = '第二浪可能结束';
else if (currentPrice > 4850) trend = '调整中';
else if (currentPrice > 4600) trend = '深度调整';
else if (currentPrice > 4540) trend = '关键区域';
else trend = '危险区域';
```

---

## 五、文档与代码对照概览

| 文档内容 | 代码状态 |
|---------|---------|
| 趋势判断 5 档价格区间 | ❌ 未实现 |
| 5100–5150 作为 (v)浪高点阈值 | ❌ 使用 5218 公式 |
| 监测点 4666、4850、4650 | ❌ 未显式加入 |
| 第二浪 W-X-Y、(x)-(w)-(y) 细分 | ❌ 主流程未输出 |
| MACD/RSI/成交量验证 | ❌ 未实现 |
| 0.236 回撤 | ✅ 已支持 |
| 1.618/2.618 延伸 | ✅ 已支持 |
| 驱动浪规则验证 | ✅ 已支持 |
| W-X-Y 识别函数 | ✅ 有，仅 `--wave` 模式使用 |

---

## 六、已实现改造（2025-02-06）

| 改造项 | 实现方式 |
|-------|---------|
| 5档趋势判断 | `trend.js` 使用 RISE_V_HIGH、IV_LOW、WAVE_2_LOW、LIFE_LINE 算法衍生 |
| 监测点算法化 | `wave.js` analyzeWave2 中计算 lifeLine=0.8回撤、riseVHigh=0.5反弹、ivLow=0.236反弹 |
| 补全 keyLevels | 增加 0.236反弹位（(iv)浪低点）、0.5反弹位（(v)浪高点） |
| W-X-Y 主流程 | 主流程非简洁模式下调用 identifyWaves12345AndABC，识别到则输出 W-X-Y |
| 无固定点位 | 全部监测点由 wave1.start、wave1.end、wave2.currentLow 及黄金分割比率计算 |

---

*生成时间：2025-02-06*
