# 黄金波浪理论+黄金分割实时分析工具

## 📖 项目说明

这是一个基于**艾略特波浪理论**和**黄金分割（斐波那契比率）**的黄金价格实时分析工具。

### 核心功能

1. ✅ **获取实时黄金价格**（使用 jijinhao.com API）
2. ✅ **多周期 K 线数据**（1小时、4小时、日线，首次运行自动生成）
3. ✅ **黄金分割计算**（回撤、反弹、延伸，算法衍生监测点）
4. ✅ **波浪理论分析**（基于 K 线推理的波浪结构，支持多周期）
5. ✅ **趋势判断**（5 档价格区间、监测点状态）
6. ✅ **时间范围推理**（指定起止时间筛选 K 线）

## 🚀 快速开始

### 安装

```bash
# 无需安装依赖，直接运行
node goldWaveAnalysis.js
```

### 首次运行说明

**首次运行时会自动生成前365天的1小时K线数据**：

1. 脚本会尝试从本地文件 `gold_price_1h.json` 读取数据
2. 如果本地文件不存在或数据不足365天，脚本会：
   - 尝试从API获取历史数据（如果配置了支持历史K线的API）
   - 如果API无法获取完整历史数据，会基于当前真实价格生成合理的历史数据
3. 生成的数据会保存到 `gold_price_1h.json` 文件中，供后续分析使用

**注意**：
- 如果API无法获取完整历史数据，生成的数据会基于当前价格和合理波动性推算
- 建议配置支持历史K线的API（如Alpha Vantage、OANDA等）以获取真实历史数据
- 数据文件会定期更新（每小时更新一次最新数据）

### 使用方法

#### 1. 单次执行

```bash
# 使用API自动获取价格（如果API失败会提示错误）
node goldWaveAnalysis.js

# 手动输入价格
node goldWaveAnalysis.js --price 5000
# 或
node goldWaveAnalysis.js -p 5000

# 使用环境变量设置价格
GOLD_PRICE=5000 node goldWaveAnalysis.js
```

#### 2. 推理周期（1小时 / 4小时 / 日线）

```bash
# 默认 1 小时 K 线推理
node goldWaveAnalysis.js --price 4820

# 按 4 小时 K 线推理
node goldWaveAnalysis.js --price 4820 --timeframe 4h

# 按日线推理
node goldWaveAnalysis.js --price 4820 --timeframe d1
```

#### 3. 时间范围推理

```bash
# 指定起始时间（至最新）
node goldWaveAnalysis.js --price 4820 --from "2026-01-22 16:00:00"

# 指定起止时间
node goldWaveAnalysis.js --price 4820 --from "2026-01-22 16:00:00" --to "2026-02-01 12:00:00"

# 使用 --range（起止可写在一起）
node goldWaveAnalysis.js --price 4820 --range "2026-01-22 16:00:00" "2026-02-01 12:00:00"
```

#### 4. 定时监控模式

```bash
# 每5分钟执行一次（默认）
node goldWaveAnalysis.js --watch

# 自定义间隔（每1分钟）
node goldWaveAnalysis.js --watch --interval 1

# 自定义间隔（每10分钟）
node goldWaveAnalysis.js --watch --interval 10

# 定时模式 + 手动价格
node goldWaveAnalysis.js --watch --price 5000

# 定时模式 + 持仓信息（成本价&金额）
# 假设成本价为 4800 USD/盎司，投入金额为 10000 CNY
node goldWaveAnalysis.js --watch --interval 1 --cost-usd 4800 --amount-cny 10000
```

**watch 模式说明**：
- 默认使用**最近 7 天的 1 小时 K 线**作为推理基数（与 `wave_chart.html` 一致）
- 使用 `identifyWaves12345AndABC` 识别推动浪 1-2-3-4-5 和调整浪 a-b-c、W-X-Y 联合形
- 仅分析 H1 周期，避免 H4/D1 数据不足告警
- 可通过 `--from` / `--range` 覆盖默认时间范围

#### 5. 波浪点位模式

```bash
# 基于历史数据识别推动浪 1-2-3-4-5 和调整浪 a-b-c
node goldWaveAnalysis.js --wave

# 波浪模式 + 4 小时
node goldWaveAnalysis.js --wave --timeframe 4h

# 波浪模式 + 时间范围
node goldWaveAnalysis.js --wave --from "2025-11-01 00:00:00"

# 波浪模式 + 生成图表
node goldWaveAnalysis.js --wave --chart --range "2026-01-15 08:00:00" "2026-02-08 06:00:00"
```

#### 6. 浏览器端波浪图表（goldWaveAnalysis_full.html）

`goldWaveAnalysis_full.html` 提供与 CLI 生成的 `wave_chart.html` 一致的 SVG 波浪点位图效果，在浏览器中直接加载 K 线 JSON 即可使用：

1. **打开方式**：用浏览器打开 `goldWaveAnalysis_full.html`，或通过本地服务器访问（如 `npx serve .`）
2. **加载数据**：点击「选择K线数据文件」，选择 `gold_price_1h.json` 或 `gold_1year_data_real.json`，点击「加载」
3. **功能**：自动识别浪 1-5、浪 a-b-c、浪 1'-5'，显示回撤/反弹位、通道线、预期走势虚线、浪点圆圈标签，支持十字准线与悬停提示
4. **依赖**：需与 `wave-browser.js` 同目录（波浪算法已移植到浏览器端）

## 📊 输出说明

脚本会输出以下信息：

1. **当前价格**：实时黄金价格
2. **当日涨跌幅**：相对当日开盘价的涨跌点数和百分比
3. **持仓收益（可选）**：
   - 成本价（USD/盎司）
   - 持仓金额（CNY）
   - 收益金额（CNY）
   - 收益率（%）
4. **趋势状态**：当前趋势判断（反弹初期/延续/强化/趋势反转）
5. **监测点状态**：
   - 支撑监测点（生命线4666）
   - 压力监测点1（第一关4838）
   - 压力监测点2（第二关4957）
   - 压力监测点3（多空分水岭5137）
6. **附近关键点位**：当前价格附近的重要点位
7. **下一个目标位**：最近的反弹目标
8. **关键点位列表**：所有重要点位（按价格排序）
9. **黄金分割计算详情**：
   - 情景一：针对整个大调整浪（5602 → 4666）
   - 情景二：针对Y浪下跌波段（5137 → 4666）

## 📋 命令行参数速查

| 参数 | 简写 | 说明 | 示例 |
|------|------|------|------|
| `--price` | `-p` | 手动输入价格 | `--price 4820` |
| `--timeframe` | `-T` | 推理周期：h1 / 4h / d1 | `--timeframe 4h` |
| `--from` | `-f` | 时间范围起始 | `--from "2026-01-22 16:00:00"` |
| `--to` | `-t` | 时间范围结束 | `--to "2026-02-01 12:00:00"` |
| `--range` | `-r` | 时间范围（起 [止]） | `--range "2026-01-22" "2026-02-01"` |
| `--watch` | `-w` | 定时监控模式 | `--watch --interval 5` |
| `--wave` | `-W` | 波浪点位模式 | `--wave --timeframe 4h` |
| `--cost-usd` | | 持仓成本价（USD） | `--cost-usd 4800` |
| `--amount-cny` | | 持仓金额（CNY） | `--amount-cny 10000` |

## 🔧 配置说明

### 获取黄金价格的方式

脚本支持多种方式获取价格，按优先级排序：

#### 方案1：手动输入价格（推荐用于测试）

```bash
# 命令行参数
node goldWaveAnalysis.js --price 5000
node goldWaveAnalysis.js -p 5000

# 环境变量
GOLD_PRICE=5000 node goldWaveAnalysis.js
```

#### 方案2：使用API自动获取价格

脚本默认会从 **jijinhao.com API** 自动获取实时黄金价格。

**当前使用的API**：
- **jijinhao.com** - 通过金投网（quote.cngold.org）的API获取现货黄金价格
  - API地址：`https://api.jijinhao.com/quoteCenter/realTime.htm?codes=JO_92233`
  - 需要设置 Referrer 头：`https://quote.cngold.org/gjs/`
  - 返回格式：JavaScript变量格式 `var quote_json = {...}`
  - 价格字段：`q5`（最新价）或 `q6`（买入/卖出价）

**如果API获取失败**：
- 脚本会提示错误信息
- 请使用 `--price` 参数或 `GOLD_PRICE` 环境变量手动指定价格

#### 方案3：修改代码直接返回价格

```javascript
// 在 getCurrentGoldPrice 函数开头直接返回
async function getCurrentGoldPrice() {
  return 5000; // 固定价格
}
```

## 📐 计算逻辑说明

### 1. 黄金分割比率

- **回撤比率**：0.236, 0.382, 0.5, 0.618, 0.786
- **反弹比率**：0.382, 0.5, 0.618, 0.786
- **延伸比率**：1.618, 2.618

### 2. 关键点位计算

#### 回撤支撑位
```
支撑 = 高点 - 比率 × (高点 - 低点)
```

#### 反弹压力位
```
压力 = 低点 + 比率 × (高点 - 低点)
```

#### 延伸目标位
```
目标 = 终点 + (比率 - 1) × (终点 - 起点)
```

### 3. 趋势判断规则

- **跌破4666**：Y浪可能未结束，下行目标4550-4481
- **突破4838**：反弹确立，目标4957
- **突破4957**：反弹延续，目标5137
- **突破5137**：多空分水岭，调整可能结束，目标5401

## 📋 关键点位速查

### 从4666起点的反弹目标（按重要性）

1. **4846** - Y浪0.382反弹位（第一压力）
2. **4902** - Y浪0.5反弹位
3. **4938** - 原强支撑转压力
4. **4957** - Y浪0.618反弹位（第二关）
5. **5023** - 大调整0.382反弹位
6. **5091/5094** - 强支撑/压力转换位
7. **5134** - 大调整0.5反弹位
8. **5137** - **多空分水岭**（最重要）
9. **5192** - 原W浪0.618反弹目标
10. **5244** - 大调整0.618反弹位
11. **5401** - 大调整0.786反弹位（趋势反转目标）

## ⚠️ 风险声明

1. **技术分析仅为概率推演**，不构成任何交易建议
2. **波浪理论存在主观性**，需结合多个时间周期验证
3. **市场风险**：需结合宏观经济（美联储政策、地缘政治）等因素综合判断
4. **本工具不对任何交易行为负责**

## 📚 相关文档

- `黄金波浪理论推理文档/` - 完整的推理逻辑和计算细节（已拆分为多文件，见该文件夹内 README）
- `波浪理论核心算法提炼/` - 核心算法提炼与实现示例（已拆分为多文件，见该文件夹内 README）
- `波浪.md` - 原始文档

## 🔄 更新日志

### v2.0.0 (2026-02-06)
- ✅ **多周期推理**：支持 1 小时、4 小时、日线（`--timeframe h1/4h/d1`）
- ✅ **时间范围推理**：支持指定起止时间（`--from`、`--to`、`--range`）
- ✅ **5 档趋势判断**：基于算法衍生监测点（>5100、4850-5100、4600-4850、4540-4600、<4540）
- ✅ **算法衍生监测点**：生命线、(iv)浪低点、(v)浪高点等由黄金分割计算，非固定点位
- ✅ **W-X-Y 联合形**：主流程自动识别并输出
- ✅ **波浪点位模式**：`--wave` 支持多周期和时间范围
- ✅ **一致波浪结构**：波浪识别始终用最近 5 天数据，保证无论显示范围如何，驱动浪/调整浪点位一致（排除更早回调浪如 1-29）；浪点统一红色

### v1.0.0 (2026-02-06)
- ✅ 实现实时黄金价格获取
- ✅ 实现黄金分割计算（回撤、反弹、延伸）
- ✅ 实现波浪理论分析（基于C浪终点4666）
- ✅ 实现趋势判断和监测点分析
- ✅ 实现格式化输出

## 📝 使用示例

```bash
# 单次分析
$ node goldWaveAnalysis.js

📊 黄金波浪理论实时分析报告
================================================================================

💰 当前价格: 5000
📍 C浪终点（起点）: 4666
📈 趋势状态: 反弹强化

📈 已突破第二关4957，目标突破多空分水岭5137

🔍 监测点状态:
   支撑监测点（生命线）: 4666 ✅ 未跌破
   压力监测点1（第一关）: 4838 ✅ 已突破
   压力监测点2（第二关）: 4957 ✅ 已突破
   压力监测点3（多空分水岭）: 5137 ⏳ 未突破

🎯 下一个目标位: 5023 - 大调整0.382反弹位 (距离23点)

...
```

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License
